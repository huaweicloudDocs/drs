# PostgreSQL数据库<a name="drs_02_0011"></a>

介绍PostgreSQL数据库在线迁移的使用限制。在正式使用数据复制服务之前，请先阅读以确保源数据库和目标数据库已经满足以下使用条件。

## 全量迁移<a name="section186103015385"></a>

数据复制服务对于全量迁移的PostgreSQL数据库有如下限制：

-   源数据库支持如下版本：
    -   PostgreSQL 9.5.x
    -   PostgreSQL 9.6.x
    -   PostgreSQL 10.0.x

-   不支持向PostgreSQL 9.5或低于该版本的目标数据库迁移。
-   全量迁移支持在跨大版本间迁移，不允许从高的大版本迁移到低的大版本。
-   迁移过程中，不允许添加、修改或删除源数据库所有用户的用户名、密码、权限和源数据库端口号。
-   目前PostgreSQL数据库迁移不支持对象选择。
-   目前PostgreSQL数据库不支持存储过程和方法的迁移。
-   目标数据库实例的运行状态必须正常。
-   源数据库帐户需要具备select权限。
-   目标数据库实例需要为空。
-   目标数据库实例必须有足够的磁盘空间。
-   同一个关系型数据库只能同时成为一个迁移任务的目标数据库。
-   需要提供目标数据库根帐号的密码。

## 全量+增量迁移<a name="section122021507393"></a>

数据复制服务对于全量+增量迁移的PostgreSQL数据库有如下限制：

-   源数据库支持如下版本：
    -   PostgreSQL 9.5.x
    -   PostgreSQL 9.6.x
    -   PostgreSQL 10.0.x

-   源数据库帐户需要具备superuser或者replication的权限。
-   增量迁移只能在相同大版本间迁移，不允许从高的大版本迁移到低的大版本。
-   目前PostgreSQL数据库迁移不支持对象选择。
-   增量迁移需要源数据库的“pg\_hba.conf“  文件中包含如下的配置：

    ```
    host replication all 0.0.0.0/0 md5
    ```

-   目前PostgreSQL数据库不支持存储过程和方法的迁移。
-   增量迁移过程中，目标数据库处于不可读写状态。
-   迁移过程中，不允许添加、修改或删除源数据库所有用户的用户名、密码、权限和源数据库端口号。
-   源数据库参数max\_wal\_senders和max\_replication\_slots必须大于0。
-   源数据库参数hot\_standby和full\_page\_write必须开启。
-   源数据库参数max\_prepared\_transactions需要比目标数据库小。
-   源数据库参数max\_worker\_processes需要比目标数据库小。
-   源数据库参数max\_locks\_per\_transaction需要比目标数据库小。
-   源数据库参数max\_connections需要比目标数据库小。
-   目标数据库实例的运行状态必须正常。
-   源数据库和目标数据库的货币金额格式必须一致。
-   目标数据库实例必须有足够的磁盘空间。
-   同一个关系型数据库只能同时成为一个迁移任务的目标数据库。
-   需要提供目标数据库根帐号的密码。

