# MySQL-\>MySQL<a name="drs_04_0100"></a>

## 使用技巧（需要人为配合）<a name="section187798577149"></a>

-   如果您使用的是全量迁移模式（离线迁移），确保源和目标数据库无业务写入，保证迁移前后数据一致。

-   如果您使用的是全量+增量迁移模式（在线迁移），支持在源数据库有业务数据写入的情况下进行迁移，推荐**提前2-3天**启动任务，并配合如下使用技巧和对应场景的[操作要求](#section174781524518)，以确保顺利迁移。
    -   基于以下原因，建议您结合定时启动功能，选择业务低峰期开始运行迁移任务，相对静态的数据，迁移时复杂度将会降低。如果迁移不可避免业务高峰期，推荐使用迁移限速功能，即“流速模式“选择“限速“。
        -   全量迁移会对源数据库有一定的访问压力。
        -   迁移无主键表时，为了确保数据一致性，会存在3s以内的单表级锁定。
        -   正在迁移的数据被其他事务长时间锁死，可能导致读数据超时。
        -   由于MySQL固有特点限制，CPU资源紧张时，存储引擎为Tokudb的表，读取速度可能下降至10%。

    -   建议您结合数据对比的“稍后启动“功能，选择业务低峰期进行数据对比，以便得到更为具有参考性的对比结果。由于同步具有轻微的时差，在数据持续操作过程中进行对比任务，可能会出现少量数据不一致对比结果，从而失去参考意义。


## 操作要求<a name="section174781524518"></a>

由于一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

**表 1**  操作要求

<a name="table9661205018457"></a>
<table><thead align="left"><tr id="row10661150144514"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p9661155018457"><a name="p9661155018457"></a><a name="p9661155018457"></a><strong id="b18661350194514"><a name="b18661350194514"></a><a name="b18661350194514"></a>类型名称</strong></p>
</th>
<th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p5661550174518"><a name="p5661550174518"></a><a name="p5661550174518"></a><strong id="b15661185011453"><a name="b15661185011453"></a><a name="b15661185011453"></a>操作限制</strong>（需要人为配合）</p>
</th>
</tr>
</thead>
<tbody><tr id="row966110508450"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p26611750124519"><a name="p26611750124519"></a><a name="p26611750124519"></a>注意事项</p>
</td>
<td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul8661145064511"></a><a name="ul8661145064511"></a><ul id="ul8661145064511"><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、存储过程/函数/触发器引用视图/表、主外键关联表等。</li><li>不支持外键级联操作。</li><li>不支持高版本到低版本的迁移。</li><li>源数据库实例没有开启GTID的情况下，不支持主备倒换。</li><li>支持断点续传功能，但是对于无主键的表可能会出现重复插入数据的情况。</li><li>在未选择任何表的情况下，无法单独迁移视图、存储过程等对象。同时目前不支持DRS自动判断依存关系，如：具有主外键关系的表，单独迁移将会失败，迁移时需要一起迁移。</li><li>若专属计算集群不支持4vCPU/8G或以上规格实例，则无法创建迁移任务。</li><li>全量迁移不支持修改表结构等DDL操作。</li><li>目标数据库实例状态需为可读写状态，否则可能迁移失败。</li><li>源库和目标库为RDS for MySQL实例时，不支持带有TDE特性并建立具有加密功能表。</li></ul>
</td>
</tr>
<tr id="row8662205084513"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p15662115084513"><a name="p15662115084513"></a><a name="p15662115084513"></a>操作须知</p>
</td>
<td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul10662750104511"></a><a name="ul10662750104511"></a><ul id="ul10662750104511"><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>迁移过程中，不建议对目标数据库进行主备切换。</li><li>在迁移任务结束之前，不允许目标数据库提前中断公网连接。</li><li>迁移过程中，不允许源库写入binlog格式为statement的数据。</li><li>迁移过程中，不允许源库执行清除binlog的操作。</li></ul>
</td>
</tr>
</tbody>
</table>

