# 使用须知<a name="drs_online_migration"></a>

数据复制服务在使用上有一些固定的限制，用来提高数据迁移的稳定性和安全性。在正式使用数据复制服务之前，请先阅读以确保各存储引擎已满足使用限制条件。

**表 1**  使用技巧

<a name="table2377810151517"></a>
<table><thead align="left"><tr id="row1337701021514"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p20377181017150"><a name="p20377181017150"></a><a name="p20377181017150"></a><strong id="b10377131016158"><a name="b10377131016158"></a><a name="b10377131016158"></a>类型名称</strong></p>
</th>
<th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p437791081511"><a name="p437791081511"></a><a name="p437791081511"></a><strong id="b737713105155"><a name="b737713105155"></a><a name="b737713105155"></a>操作限制</strong>（需要人为配合）</p>
</th>
</tr>
</thead>
<tbody><tr id="row737871081518"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p17378111018151"><a name="p17378111018151"></a><a name="p17378111018151"></a>使用技巧</p>
</td>
<td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><p id="p1860018231283"><a name="p1860018231283"></a><a name="p1860018231283"></a>如果您使用的是全量迁移模式，请确保源和目标数据库无其他业务写入。</p>
<div class="p" id="p10287244153216"><a name="p10287244153216"></a><a name="p10287244153216"></a>如果您使用的是全量+增量迁移模式，支持在源数据库有业务数据写入的情况下进行迁移，推荐<strong id="b3109185571814"><a name="b3109185571814"></a><a name="b3109185571814"></a>提前2-3天</strong>启动任务，并配合如下使用技巧（<a href="#table2377810151517">表1</a>）、操作要求（<a href="#table635193319310">表2</a>到<a href="#table2703504253">表12</a>的操作要求）以确保顺利割接。<a name="ul13378110121520"></a><a name="ul13378110121520"></a><ul id="ul13378110121520"><li>全量迁移<div class="p" id="p585144144319"><a name="p585144144319"></a><a name="p585144144319"></a>基于以下原因，建议您结合定时启动功能，选择业务低峰期开始运行迁移任务，相对静态的数据，迁移时复杂度将会降低。如果迁移不可避免业务高峰期，推荐使用迁移限速功能，即<span class="uicontrol" id="uicontrol4378110191516"><a name="uicontrol4378110191516"></a><a name="uicontrol4378110191516"></a>“流速模式”</span>选择<span class="uicontrol" id="uicontrol15378181051517"><a name="uicontrol15378181051517"></a><a name="uicontrol15378181051517"></a>“限速”</span>。<a name="ul12378110191512"></a><a name="ul12378110191512"></a><ul id="ul12378110191512"><li>全量迁移会对源数据库有一定的访问压力。</li><li>迁移无主键表时，为了确保数据一致性，会存在3s以内的单表级锁定。</li><li>正在迁移的数据被其他事务长时间锁死，可能导致读数据超时。</li><li>由于MySQL固有特点限制，CPU资源紧张时，存储引擎为Tokudb的表，读取速度可能下降至10%。</li></ul>
</div>
</li><li>数据对比<p id="p7101103054416"><a name="p7101103054416"></a><a name="p7101103054416"></a>建议您结合数据对比的<span class="uicontrol" id="uicontrol737816105154"><a name="uicontrol737816105154"></a><a name="uicontrol737816105154"></a>“稍后启动”</span>功能，选择业务低峰期进行数据对比，以便得到更为具有参考性的对比结果。由于同步具有轻微的时差，在数据持续操作过程中进行对比任务，可能会出现少量数据不一致对比结果，从而失去参考意义。</p>
</li></ul>
</div>
</td>
</tr>
</tbody>
</table>

## MySQL-\>RDS for MySQL迁移场景<a name="section1763851924716"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 2**  操作要求

    <a name="table635193319310"></a>
    <table><thead align="left"><tr id="row93512332311"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p11351833835"><a name="p11351833835"></a><a name="p11351833835"></a><strong id="b93511033834"><a name="b93511033834"></a><a name="b93511033834"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p9351233539"><a name="p9351233539"></a><a name="p9351233539"></a><strong id="b53515331031"><a name="b53515331031"></a><a name="b53515331031"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row2426155314372"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p20426195373718"><a name="p20426195373718"></a><a name="p20426195373718"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul884918291198"></a><a name="ul884918291198"></a><ul id="ul884918291198"><li><a href="#table14354185617365">表3</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、视图引用视图、存储过程/函数/触发器引用视图/表、主外键关联表等。</li><li>由于MySQL本身限制，若源库的一次性EVENT设定的触发时间在迁移开始前，该EVENT不会迁移到目标库。</li><li>多对一场景下，创建迁移任务时，目标库读写设置需要跟已有任务设置为一致。</li><li>增量迁移会过滤创建用户、删除用户及修改用户权限的DDL操作。</li><li>由于无主键表缺乏行的唯一性标志，在网络不稳定情况下，迁移后，可能存在目标与源库数据不一致的情况。</li><li>若专属计算集群不支持4vCPU/8G或以上规格实例，则无法创建迁移任务。</li></ul>
    </td>
    </tr>
    <tr id="row183512331137"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1135173316316"><a name="p1135173316316"></a><a name="p1135173316316"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul106391278103"></a><a name="ul106391278103"></a><ul id="ul106391278103"><li>全量迁移过程中，不建议对源数据库的表进行修改、删除等DDL操作。</li><li>在结束迁移任务时，将进行所选事件（event）和触发器（trigger）的迁移。请确保任务结束前，不要断开源和目标数据库的网络连通性，并在结束任务时关注迁移日志上报的状态，达到数据库完整迁移效果。</li><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>增量迁移场景下，不支持源数据库进行恢复到某个备份点的操作（PITR）。</li><li>增量迁移过程中，若源库存在分布式事务，可能会导致迁移失败。</li><li>为了保持数据一致性，不允许对正在迁移中的目标数据库进行修改操作(包括但不限于DDL、DML操作)。</li><li>增量迁移阶段，支持断点续传功能，在主机系统崩溃的情况下，对于非事务性的无主键的表可能会出现重复插入数据的情况。</li><li>迁移过程中，不允许源库写入binlog格式为statement的数据。</li><li>迁移过程中，不允许源库执行清除binlog的操作。</li><li>选择表级对象迁移时，增量迁移过程中不建议对表进行重命名操作。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 3**  环境要求

    <a name="table14354185617365"></a>
    <table><thead align="left"><tr id="row1835475617361"><th class="cellrowborder" valign="top" width="18.37%" id="mcps1.2.3.1.1"><p id="p203548561368"><a name="p203548561368"></a><a name="p203548561368"></a><strong id="b1354175683612"><a name="b1354175683612"></a><a name="b1354175683612"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.63%" id="mcps1.2.3.1.2"><p id="p13354125633613"><a name="p13354125633613"></a><a name="p13354125633613"></a><strong id="b13191306372"><a name="b13191306372"></a><a name="b13191306372"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row135415610367"><td class="cellrowborder" valign="top" width="18.37%" headers="mcps1.2.3.1.1 "><p id="p14354205683618"><a name="p14354205683618"></a><a name="p14354205683618"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.63%" headers="mcps1.2.3.1.2 "><a name="ul982375513817"></a><a name="ul982375513817"></a><ul id="ul982375513817"><li><strong id="b582410553818"><a name="b582410553818"></a><a name="b582410553818"></a>全量迁移权限要求：</strong><a name="ul10824155517813"></a><a name="ul10824155517813"></a><ul id="ul10824155517813"><li>源数据库帐户需要具备如下权限：SELECT、SHOW VIEW、EVENT。</li><li>目标数据库帐号必须拥有如下权限：SELECT、CREATE、ALTER、DROP、DELETE、INSERT、UPDATE、INDEX、EVENT、CREATE VIEW、CREATE ROUTINE、TRIGGER、WITH GRANT OPTION。</li></ul>
    </li><li><strong id="b178248551783"><a name="b178248551783"></a><a name="b178248551783"></a>全量+增量迁移权限要求：</strong><a name="ul1282418553810"></a><a name="ul1282418553810"></a><ul id="ul1282418553810"><li>源数据库帐户需要具备如下权限：SELECT、SHOW VIEW、EVENT、LOCK TABLES、REPLICATION SLAVE、REPLICATION CLIENT。</li><li>目标数据库帐号必须拥有如下权限：SELECT、CREATE、ALTER、DROP、DELETE、INSERT、UPDATE、INDEX、EVENT、CREATE VIEW、CREATE ROUTINE、TRIGGER、WITH GRANT OPTION。</li></ul>
    </li><li><strong id="b982416557815"><a name="b982416557815"></a><a name="b982416557815"></a>用户迁移权限要求：</strong><p id="p8824175514815"><a name="p8824175514815"></a><a name="p8824175514815"></a>用户迁移时，当源数据库为非阿里云数据库时，帐户需要有mysql.user的SELECT权限，源数据库为阿里云数据库，则帐户需要同时具有mysql.user和mysql.user_view的SELECT权限。目标数据库帐户需要有mysql库的SELECT，INSERT，UPDATE，DELETE权限。</p>
    </li></ul>
    </td>
    </tr>
    <tr id="row103558568366"><td class="cellrowborder" valign="top" width="18.37%" headers="mcps1.2.3.1.1 "><p id="p18355056133620"><a name="p18355056133620"></a><a name="p18355056133620"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.63%" headers="mcps1.2.3.1.2 "><a name="ul188248551186"></a><a name="ul188248551186"></a><ul id="ul188248551186"><li>支持数据库、表、视图、索引、约束、函数、存储过程、触发器和事件的迁移。</li><li>不支持系统库的迁移以及事件状态的迁移。</li><li>不支持非Myisam、InnoDB表的迁移。</li></ul>
    </td>
    </tr>
    <tr id="row16355185612365"><td class="cellrowborder" valign="top" width="18.37%" headers="mcps1.2.3.1.1 "><p id="p1635555643615"><a name="p1635555643615"></a><a name="p1635555643615"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.63%" headers="mcps1.2.3.1.2 "><a name="ul19309616912"></a><a name="ul19309616912"></a><ul id="ul19309616912"><li>源数据库中的库名不能包含：'&lt;`&gt;/\以及非ASCII字符。</li><li>源数据库中的表名、视图名不能包含：'&lt;&gt;/\以及非ASCII字符</li><li>MySQL源数据库的binlog日志必须打开，且binlog日志格式必须为Row格式。</li><li>在磁盘空间允许的情况下，建议源数据库binlog保存时间越长越好，建议为3天。</li><li>建议将expire_log_day参数设置在合理的范围，确保恢复时断点处的binlog尚未过期，以保证服务中断后的顺利恢复。</li><li>增量迁移时，必须设置MySQL源数据库的server_id。如果源数据库版本小于或等于MySQL5.6，server_id的取值范围在2－4294967296之间；如果源数据库版本大于或等于MySQL5.7，server_id的取值范围在1－4294967296之间。</li><li>MySQL源数据库建议开启skip-name-resolve，减少连接超时的可能性。</li><li>源数据库GTID状态建议为开启状态。</li><li>源库不支持阿里云RDS的只读副本。</li></ul>
    </td>
    </tr>
    <tr id="row4355356133613"><td class="cellrowborder" valign="top" width="18.37%" headers="mcps1.2.3.1.1 "><p id="p13355105614366"><a name="p13355105614366"></a><a name="p13355105614366"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.63%" headers="mcps1.2.3.1.2 "><a name="ul10931176496"></a><a name="ul10931176496"></a><ul id="ul10931176496"><li>不支持从高版本迁移到低版本。</li><li>建议MySQL目标库的binlog日志格式为Row格式，否则增量迁移可能出错。</li><li>目标数据库实例的运行状态必须正常。</li><li>目标数据库实例必须有足够的磁盘空间。</li><li>除了MySQL系统数据库之外，目标数据库不能包含与源数据库同名的数据库。</li><li>建议目标库的事务隔离级别至少保证在已提交读。</li><li>DRS迁移时会有大量数据写入目标库，目标库max_allowed_packet 参数过小会导致无法写入，建议将目标库max_allowed_packet参数值设置大一点，使其大于100MB。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


## Microsoft SQL Server-\>RDS for Microsoft SQL Server迁移场景<a name="section6817114516474"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 4**  操作要求

    <a name="table43581330132519"></a>
    <table><thead align="left"><tr id="row6358730152520"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p435833019258"><a name="p435833019258"></a><a name="p435833019258"></a><strong id="b1835933018255"><a name="b1835933018255"></a><a name="b1835933018255"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p13359123015252"><a name="p13359123015252"></a><a name="p13359123015252"></a><strong id="b1635953072516"><a name="b1635953072516"></a><a name="b1635953072516"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row163592300252"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p183591630122515"><a name="p183591630122515"></a><a name="p183591630122515"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul1750220308128"></a><a name="ul1750220308128"></a><ul id="ul1750220308128"><li><a href="#table1735863017254">表5</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、视图引用视图、存储过程/函数/触发器引用视图/表、主外键关联表等。</li><li>创建迁移实例后，必须确保迁移实例能够连通源数据库。</li><li>目标数据库实例的运行状态必须正常。</li><li>若专属计算集群不支持4vCPU/8G或以上规格实例，则无法创建迁移任务。</li><li>选择表级对象迁移时，增量迁移过程中不建议对表进行重命名操作。</li><li>迁移过程中触发器为禁用状态，在迁移任务结束时，系统自动将触发器的状态恢复为原有状态。</li></ul>
    </td>
    </tr>
    <tr id="row66562034101217"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p365763419129"><a name="p365763419129"></a><a name="p365763419129"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul114293311310"></a><a name="ul114293311310"></a><ul id="ul114293311310"><li>不支持源数据库主备切换，源数据库主备切换会导致迁移任务失败，该情况下的迁移任务不可恢复。</li><li>当RDS实例异常引发目标数据库发生主备切换时，会导致迁移失败，该情况下的迁移任务不可恢复。</li><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>增量迁移过程中，源数据库进行的DDL操作不支持迁移到目标数据库。</li><li>为保障数据一致性，对于只进行全量迁移的任务，在数据迁移期间请勿在源数据库SQL Server中写入新的数据。</li><li>支持断点续传功能，但是对于无主键的表可能会出现重复插入数据的情况。</li><li>增量迁移中，不支持大对象数据类型 image，text，ntext的删除操作。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 5**  环境要求

    <a name="table1735863017254"></a>
    <table><thead align="left"><tr id="row133581330132511"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p1235883020258"><a name="p1235883020258"></a><a name="p1235883020258"></a><strong id="b9358143013255"><a name="b9358143013255"></a><a name="b9358143013255"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p235823062516"><a name="p235823062516"></a><a name="p235823062516"></a><strong id="b7358163018256"><a name="b7358163018256"></a><a name="b7358163018256"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row3358130142511"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1935813072514"><a name="p1935813072514"></a><a name="p1935813072514"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul86522810114"></a><a name="ul86522810114"></a><ul id="ul86522810114"><li><strong id="b1665216815113"><a name="b1665216815113"></a><a name="b1665216815113"></a>全量迁移权限要求：</strong><a name="ul76526821112"></a><a name="ul76526821112"></a><ul id="ul76526821112"><li>源数据库权限：需要具备db_owner权限。</li><li>目标数据库权限：需要具备dbcreator或者CREATE ANY DATABASE的权限。</li></ul>
    </li><li><strong id="b365215813116"><a name="b365215813116"></a><a name="b365215813116"></a>全量+增量迁移权限要求：</strong><a name="ul1665212820118"></a><a name="ul1665212820118"></a><ul id="ul1665212820118"><li>当源数据库为华为云或者阿里云数据库时，源数据库需要具备db_owner权限。</li><li>当源数据库为自建数据库时，源数据库需要具备sysadmin role权限。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row9358330182516"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p435833012513"><a name="p435833012513"></a><a name="p435833012513"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul465318841119"></a><a name="ul465318841119"></a><ul id="ul465318841119"><li><strong id="b1265316819118"><a name="b1265316819118"></a><a name="b1265316819118"></a>当前版本暂不支持迁移如下数据库对象：</strong><a name="ul1565311817113"></a><a name="ul1565311817113"></a><ul id="ul1565311817113"><li>程序集（Assemblies）</li><li>service broker</li><li>全文索引</li><li>全文目录</li><li>空间索引</li><li>hash索引</li><li>xml索引</li><li>列存储索引</li><li>序列</li><li>分布式 schema</li><li>分布式函数</li><li>CLR存储过程</li><li>CLR 标量函数</li><li>CLR表值函数</li><li>内部表</li><li>聚合函数</li><li>系统</li><li>加密的数据库对象（视图、存储过程、触发器、函数）</li></ul>
    </li><li><strong id="b66541381117"><a name="b66541381117"></a><a name="b66541381117"></a>当前版本暂不支持迁移如下数据类型：</strong><a name="ul176541984115"></a><a name="ul176541984115"></a><ul id="ul176541984115"><li>sql_variant</li><li>timestamp</li></ul>
    </li><li><strong id="b269685511180"><a name="b269685511180"></a><a name="b269685511180"></a>当前版本的全量+增量迁移模式暂不支持迁移如下数据库类型：</strong><a name="ul65111328193"></a><a name="ul65111328193"></a><ul id="ul65111328193"><li>geometry</li><li>geography</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row035873011254"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p5358143018259"><a name="p5358143018259"></a><a name="p5358143018259"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul3603152214112"></a><a name="ul3603152214112"></a><ul id="ul3603152214112"><li>源数据库库名只能包含如下字符：字母、数字、下划线和中划线，库名长度不能超过64个字符。</li><li>源数据库中的表名、视图名和触发器名不能包含如下字符：'&lt;&gt;"。</li><li>不支持迁移源数据库中开启TDE(Transparent Data Encryption)加密的数据库。若不需要迁移TDE加密的库，请在对象选择中去掉；若需要迁移TDE加密的库，请先将TDE关闭。</li><li>源数据库若开启客户端配置中的“强制协议加密（Force Protocol Encrypton）”，必须同时开启“信任服务器证书（trust server certificate）”，如下图所示：<div class="fignone" id="fig260372211116"><a name="fig260372211116"></a><a name="fig260372211116"></a><span class="figcap"><b>图1 </b>查看客户端属性</span><br><a name="image160319226112"></a><a name="image160319226112"></a><span><img id="image160319226112" src="figures/查看客户端属性.jpg" width="332.83250000000004" height="212.42799900000003"></span></div>
    </li><li>源数据库模式必须设置为FULL模式。</li><li>源数据库必须开启SQL Server Agent代理服务。</li><li>源库中不允许存在被禁用的表的聚簇索引，否则会导致迁移失败。</li><li>源库中不允许存在名称为cdc的用户名或shema。</li></ul>
    </td>
    </tr>
    <tr id="row1235853012251"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p6358183052518"><a name="p6358183052518"></a><a name="p6358183052518"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul116041722121118"></a><a name="ul116041722121118"></a><ul id="ul116041722121118"><li>目标数据库实例必须有足够的磁盘空间。</li><li>不支持目标数据库主备切换。</li><li>仅支持从低版本迁移到高版本。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


## PostgreSQL-\>RDS for PostgreSQL迁移场景<a name="section445463584920"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 6**  操作要求

    <a name="table133451535182517"></a>
    <table><thead align="left"><tr id="row734510352258"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p1734523514257"><a name="p1734523514257"></a><a name="p1734523514257"></a><strong id="b6345183513255"><a name="b6345183513255"></a><a name="b6345183513255"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p17345435152514"><a name="p17345435152514"></a><a name="p17345435152514"></a><strong id="b1934583519252"><a name="b1934583519252"></a><a name="b1934583519252"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row13345135152519"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p4345183572519"><a name="p4345183572519"></a><a name="p4345183572519"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul148321012125813"></a><a name="ul148321012125813"></a><ul id="ul148321012125813"><li><a href="#table11344203562515">表7</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li><strong id="b1183381255814"><a name="b1183381255814"></a><a name="b1183381255814"></a>全量迁移要求：</strong><a name="ul1283331215817"></a><a name="ul1283331215817"></a><ul id="ul1283331215817"><li>不支持向低于PostgreSQL 9.4版本的目标数据库迁移。</li><li>支持在跨大版本间迁移，不允许从高的大版本迁移到低的大版本。</li><li>同一个迁移任务中，不支持多个源库迁移至同一个目标库。</li></ul>
    </li><li><strong id="b18833121214580"><a name="b18833121214580"></a><a name="b18833121214580"></a>全量+增量迁移要求：</strong><a name="ul108331912205817"></a><a name="ul108331912205817"></a><ul id="ul108331912205817"><li>增量迁移只能在相同大版本间迁移，不允许从高的大版本迁移到低的大版本。</li><li>增量迁移不支持源数据库为RDS实例。</li></ul>
    </li><li><strong id="b18345125586"><a name="b18345125586"></a><a name="b18345125586"></a>全量迁移和全量+增量迁移存在以下的公共的要求：</strong><a name="ul283431216585"></a><a name="ul283431216585"></a><ul id="ul283431216585"><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、视图引用视图、存储过程/函数/触发器引用视图/表、主外键关联表等。</li><li>不支持对象选择。</li><li>选择表级对象迁移时，增量迁移过程中不建议对表进行重命名操作。</li><li>若专属计算集群不支持4vCPU/8G或以上规格实例，则无法创建迁移任务。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row13192531113"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1530251625819"><a name="p1530251625819"></a><a name="p1530251625819"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul1281775585814"></a><a name="ul1281775585814"></a><ul id="ul1281775585814"><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>选择表级对象迁移时，增量迁移过程中不建议对表进行重命名操作。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 7**  环境要求

    <a name="table11344203562515"></a>
    <table><thead align="left"><tr id="row034473517259"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p3344153515253"><a name="p3344153515253"></a><a name="p3344153515253"></a><strong id="b12344133562512"><a name="b12344133562512"></a><a name="b12344133562512"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p153448357256"><a name="p153448357256"></a><a name="p153448357256"></a><strong id="b73444354252"><a name="b73444354252"></a><a name="b73444354252"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row17345163512250"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p9345143520258"><a name="p9345143520258"></a><a name="p9345143520258"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul0479011500"></a><a name="ul0479011500"></a><ul id="ul0479011500"><li><strong id="b94791619506"><a name="b94791619506"></a><a name="b94791619506"></a>全量迁移权限要求：</strong><a name="ul047916175014"></a><a name="ul047916175014"></a><ul id="ul047916175014"><li>源数据库帐户需要具备SELECT、REFERENCES、TRIGGER、EXECUTE和USAGE权限。</li></ul>
    </li><li><strong id="b547981195013"><a name="b547981195013"></a><a name="b547981195013"></a>全量+增量迁移权限要求：</strong><a name="ul174790116505"></a><a name="ul174790116505"></a><ul id="ul174790116505"><li>源数据库帐户需要具备SUPERUSER或者REPLICATION的权限。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row16345153518251"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1434573552514"><a name="p1434573552514"></a><a name="p1434573552514"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><p id="p54801911503"><a name="p54801911503"></a><a name="p54801911503"></a><strong id="b0480171185017"><a name="b0480171185017"></a><a name="b0480171185017"></a>全量迁移对象约束：</strong></p>
    <p id="p14806117500"><a name="p14806117500"></a><a name="p14806117500"></a>支持表、索引、外键、存储过程、函数、视图、约束、触发器的迁移。</p>
    <p id="p34801915507"><a name="p34801915507"></a><a name="p34801915507"></a>支持如下字段类型：数字类型、货币类型、字符类型、二进制数据类型、日期/时间类型、布尔类型、枚举类型、几何类型、网络地址类型、位串类型、文本搜索类型、UUID类型、XML类型、JSON类型、数组、复合类型、范围类型。</p>
    </td>
    </tr>
    <tr id="row1345113572516"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p14345435122512"><a name="p14345435122512"></a><a name="p14345435122512"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul10845172125813"></a><a name="ul10845172125813"></a><ul id="ul10845172125813"><li>源数据库的库名和表名不支持如下字符："&lt;&gt;。</li><li><strong id="b8845172155819"><a name="b8845172155819"></a><a name="b8845172155819"></a>增量迁移时，源数据库需要配置如下信息：</strong><a name="ul12845121584"></a><a name="ul12845121584"></a><ul id="ul12845121584"><li>增量迁移需要源数据库的<span class="filepath" id="filepath1084519255811"><a name="filepath1084519255811"></a><a name="filepath1084519255811"></a>“pg_hba.conf”</span> 文件中包含如下的配置：<pre class="codeblock" id="codeblock18451214581"><a name="codeblock18451214581"></a><a name="codeblock18451214581"></a>host replication all 0.0.0.0/0 md5</pre>
    </li><li>源数据库参数max_wal_senders和max_replication_slots必须大于0。</li><li>源数据库参数hot_standby和full_page_write必须开启。</li><li>源数据库参数max_prepared_transactions需要比目标数据库小。</li><li>源数据库参数max_worker_processes需要比目标数据库小。</li><li>源数据库参数max_locks_per_transaction需要比目标数据库小。</li><li>源数据库参数max_connections需要比目标数据库小。</li><li>源数据库和目标数据库的货币金额格式必须一致。</li><li>目标库为PostgreSQL 11.x或者PostgreSQL增强版时，源库中同一个数据库下的触发器名称必须唯一。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row8345153582517"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p113456350256"><a name="p113456350256"></a><a name="p113456350256"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul984614218586"></a><a name="ul984614218586"></a><ul id="ul984614218586"><li>目标数据库实例的运行状态必须正常。</li><li>增量迁移时，目标数据库实例需要为空。</li><li>目标数据库实例必须有足够的磁盘空间。</li><li>不支持多对一的迁移。</li><li>需要提供目标数据库根帐号的密码。</li><li>增量迁移过程中，目标数据库处于不可读写状态。</li><li>增量迁移时，目标库实例不能带只读实例。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


## MongoDB数据库-\>DDS迁移场景<a name="section186871129105019"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 8**  操作要求

    <a name="table141711140172514"></a>
    <table><thead align="left"><tr id="row161711140132518"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p101717405259"><a name="p101717405259"></a><a name="p101717405259"></a><strong id="b101711040142515"><a name="b101711040142515"></a><a name="b101711040142515"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p0171194052517"><a name="p0171194052517"></a><a name="p0171194052517"></a><strong id="b817119408253"><a name="b817119408253"></a><a name="b817119408253"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row4171144072514"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p21711240162516"><a name="p21711240162516"></a><a name="p21711240162516"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul96010181148"></a><a name="ul96010181148"></a><ul id="ul96010181148"><li><a href="#table13170174072512">表9</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用集合、视图引用视图等。</li><li>副本集：MongoDB数据库的副本集实例状态必须正常，要存在主节点。</li><li>单节点：目前不支持源数据库为非本云单节点实例的迁移。</li></ul>
    <a name="ul4604186414"></a><a name="ul4604186414"></a><ul id="ul4604186414"><li><strong id="b1361218941"><a name="b1361218941"></a><a name="b1361218941"></a>源数据库为非集群实例时，增量迁移阶段支持如下操作：</strong><a name="ul19611318247"></a><a name="ul19611318247"></a><ul id="ul19611318247"><li>支持数据库（database）新建、删除。</li><li>支持文档（document）新增、删除、更新。</li><li>支持集合（collection）新建、删除。</li><li>支持索引（index）新建、删除。</li><li>支持视图（view）新建，删除。</li><li>支持convertToCapped、collMod、renameCollection命令。</li></ul>
    </li><li>副本集到集群的全量+增量迁移，迁移之前建议在目标数据库的集群先进行分片配置，再启动迁移。</li><li>对于在源数据库已经存在TTL索引的集合，或者在增量迁移期间在源库数据创建了TTL索引的集合，由于源数据库和目标库数据库时区，时钟的不一致，不能保证迁移完成之后数据的一致性。</li><li>如果源数据库的mongod服务不是单独部署的，而是和其他的服务部署在同一台机器，则必须要给源数据库的wiredTiger引擎加上cacheSizeGB的参数配置，建议值设为最小空闲内存的一半。</li><li>专属计算集群暂不支持DDS实例，无法创建迁移任务。</li><li>选择集合迁移时，增量迁移过程中不建议对集合进行重命名操作。</li><li>如果源数据库是副本集或者单节点，并且目标库是集群的话，则建议根据源库的数据模型，在目标库提前设置好分片键。</li><li>如果源数据库是副本集，则建议填写所有的主节点和备节点信息，以防主备切换影响迁移任务。如果填写的是主备多个节点的信息，注意所有的节点信息必须属于同一个副本集实例。</li><li>如果源数据库是集群，则建议填写多个mongos信息，以防单个mongos节点故障影响迁移任务。如果填写的是多个mongos信息，注意所有的mongos信息必须属于同一个集群。如果是集群的增量迁移任务，建议shard信息填写所有的主节点和备节点，以防主备切换影响迁移任务，并且注意所填写的主备信息必须属于同一个shard。</li></ul>
    </td>
    </tr>
    <tr id="row5809121172917"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p194166225417"><a name="p194166225417"></a><a name="p194166225417"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul131181513558"></a><a name="ul131181513558"></a><ul id="ul131181513558"><li>为了保持数据一致性，在整个迁移过程中，不允许对正在迁移中的目标数据库进行修改操作(包括但不限于DDL、DML操作)，也不支持对源数据库进行DDL操作。</li><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>在整个迁移过程中，不支持源数据库主备切换导致数据回滚的情况。</li><li>选择集合迁移时，增量迁移过程中不建议对集合进行重命名操作。</li><li>为了提高迁移的速度，在开始迁移之前，建议在源数据库删掉不需要的索引，只保留必须的索引。在迁移过程中不建议对源库创建索引，如果必须要创建索引，请使用后台的方式创建索引。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 9**  环境要求

    <a name="table13170174072512"></a>
    <table><thead align="left"><tr id="row61701240112514"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p16170184022520"><a name="p16170184022520"></a><a name="p16170184022520"></a><strong id="b717064072512"><a name="b717064072512"></a><a name="b717064072512"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p14170114018257"><a name="p14170114018257"></a><a name="p14170114018257"></a><strong id="b91701440182512"><a name="b91701440182512"></a><a name="b91701440182512"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row10170144019250"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p17170114019255"><a name="p17170114019255"></a><a name="p17170114019255"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul029116331033"></a><a name="ul029116331033"></a><ul id="ul029116331033"><li><strong id="b132911533834"><a name="b132911533834"></a><a name="b132911533834"></a>全量迁移权限要求：</strong><a name="ul132916339311"></a><a name="ul132916339311"></a><ul id="ul132916339311"><li>副本集：连接源数据库的用户权限需要对待迁移的用户数据库有read权限。</li><li>集群：连接源数据库的用户权限需要对待迁移的用户数据库和config数据库有read权限。</li><li>单节点：连接源数据库的用户权限需要对待迁移的用户数据库有read权限。</li></ul>
    </li><li><strong id="b142922335312"><a name="b142922335312"></a><a name="b142922335312"></a>全量+增量迁移权限要求：</strong><a name="ul5292153310319"></a><a name="ul5292153310319"></a><ul id="ul5292153310319"><li>副本集：连接源数据库的用户权限需要对待迁移的用户数据库和local数据库有read权限。</li><li>单节点：连接源数据库的用户权限需要对待迁移的用户数据库和local数据库有read权限。</li><li>集群：连接源数据库mongos节点的用户权限需要对待迁移的用户数据库和config数据库有read权限， 连接源数据库分片节点的用户权限需要对待迁移的用户数据库和local数据库有read权限。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row1117034010253"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p18170194019257"><a name="p18170194019257"></a><a name="p18170194019257"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul629211339312"></a><a name="ul629211339312"></a><ul id="ul629211339312"><li>副本集：目前只支持集合(包括验证器，是否是固定集合)，索引和视图的迁移。</li><li>集群：目前只支持集合（包括验证器，是否是固定集合），分片键，索引和视图的迁移。</li><li>单节点：目前只支持集合（包括验证器，是否是固定集合），索引和视图的迁移。</li><li>只支持迁移用户数据和源数据库的账号信息，不支持迁移系统库和系统集合，如果业务数据在系统库下，则需要先将业务数据移动到用户数据库下，可以使用renameCollection命令进行移出。</li><li>不支持_id字段没有索引的集合。</li></ul>
    </td>
    </tr>
    <tr id="row117004013254"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p917018408251"><a name="p917018408251"></a><a name="p917018408251"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul1320116447316"></a><a name="ul1320116447316"></a><ul id="ul1320116447316"><li>不支持源数据库的库名、集合名或视图名中包含如下字符：'&lt;&gt;.。</li><li>如果迁移任务是源数据集群的增量，则源数据必须关闭Balancer。</li></ul>
    </td>
    </tr>
    <tr id="row1517094013252"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1017074042515"><a name="p1017074042515"></a><a name="p1017074042515"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul17202944533"></a><a name="ul17202944533"></a><ul id="ul17202944533"><li>目标数据库实例的运行状态必须正常。</li><li>目标数据库实例必须有足够的磁盘空间。</li><li>多个源数据库迁移到同一个目标数据库时，所选的待迁移数据库的库名不能重复。</li><li>集群到集群的全量迁移，如果源数据库的集群没有开启分片，则需要保证目标数据库主shard节点的磁盘空间大于源数据库数据大小。</li><li>目前不支持从高版本数据库到低版本数据库的迁移。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


## Oracle数据库-\>RDS for MySQL迁移场景<a name="section124877427572"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 10**  操作要求

    <a name="table11845945102517"></a>
    <table><thead align="left"><tr id="row78452454256"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p1484594514258"><a name="p1484594514258"></a><a name="p1484594514258"></a><strong id="b7845194552514"><a name="b7845194552514"></a><a name="b7845194552514"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p178451345192518"><a name="p178451345192518"></a><a name="p178451345192518"></a><strong id="b384594542512"><a name="b384594542512"></a><a name="b384594542512"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row128454455258"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p14845145102518"><a name="p14845145102518"></a><a name="p14845145102518"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul458913216619"></a><a name="ul458913216619"></a><ul id="ul458913216619"><li><a href="#table9844945152511">表11</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、视图引用视图、主外键关联表等。</li><li>表、视图等对象名迁移到目标库后会转换成小写，如ABC和abc。</li><li>源库和目标库时区设置必须一致。</li><li>如有中文、日文等特殊字符，业务连接Oracle数据库使用的编码需和Oracle数据库服务端编码一致，否则目标库会出现乱码。</li><li>Oracle中表结构迁移到MySQL后表的字符集为utf8mb4。</li><li>由于无主键表缺乏行的唯一性标志，在网络不稳定情况下，迁移后，可能存在目标与源库数据不一致的情况。</li><li>Oracle中表结构长度（所有列长字节数之和，char、varchar2等类型字节长度和编码有关）超过65535时，可能导致迁移失败。</li><li>源库为oracle RAC环境时，不支持使用scanip创建任务，可以使用某一节点作为源库，除配置任务时使用的节点外，源库其他节点异常依然可以正常迁移。</li></ul>
    </td>
    </tr>
    <tr id="row1193511717304"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p168963510620"><a name="p168963510620"></a><a name="p168963510620"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul2754125510574"></a><a name="ul2754125510574"></a><ul id="ul2754125510574"><li>对于迁移中的数据库对象，在迁移期间，目标库不能进行写入操作，否则会导致数据不一致。</li><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>迁移过程中，源库不能做DDL变更。</li><li>选择表级对象迁移时，增量迁移过程中不建议对表进行重命名操作</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 11**  环境要求

    <a name="table9844945152511"></a>
    <table><thead align="left"><tr id="row0844184562510"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p9845144502515"><a name="p9845144502515"></a><a name="p9845144502515"></a><strong id="b78455453251"><a name="b78455453251"></a><a name="b78455453251"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p20845124582516"><a name="p20845124582516"></a><a name="p20845124582516"></a><strong id="b20845164542512"><a name="b20845164542512"></a><a name="b20845164542512"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row284554522519"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p8845445122512"><a name="p8845445122512"></a><a name="p8845445122512"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul1420813399512"></a><a name="ul1420813399512"></a><ul id="ul1420813399512"><li><strong id="b102081439352"><a name="b102081439352"></a><a name="b102081439352"></a>全量迁移权限要求：</strong><a name="ul172085399513"></a><a name="ul172085399513"></a><ul id="ul172085399513"><li>源数据库端：需要具有DBA权限。</li><li>目标数据库端：提供的目标数据库帐号必须拥有如下权限：SELECT、CREATE、DROP、DELETE、INSERT、UPDATE、ALTER、INDEX、EVENT、RELOAD、CREATE VIEW、CREATE ROUTINE、TRIGGER。</li></ul>
    </li><li><strong id="b22088391851"><a name="b22088391851"></a><a name="b22088391851"></a>全量+增量迁移权限要求：</strong><a name="ul1120913910515"></a><a name="ul1120913910515"></a><ul id="ul1120913910515"><li>源数据库端：需要具有DBA和LOGMINING权限。</li><li>目标数据库端：提供的目标数据库帐号必须拥有如下权限：SELECT、CREATE、DROP、DELETE、INSERT、UPDATE、ALTER、INDEX、EVENT、RELOAD、CREATE VIEW、CREATE ROUTINE、TRIGGER。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row884564511257"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p9845174542510"><a name="p9845174542510"></a><a name="p9845174542510"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul11209739557"></a><a name="ul11209739557"></a><ul id="ul11209739557"><li>支持库、表结构、视图、主键、唯一键、外键、索引、表数据的迁移，其他数据库对象暂不支持，如存储过程、触发器、函数、序列、包、同义词、用户等。</li><li>增量迁移不支持DDL的同步。</li><li>增量阶段不支持bfile，xml、interval、sdo_geometry和自定义类型。</li></ul>
    </td>
    </tr>
    <tr id="row20845194518252"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p78452045152519"><a name="p78452045152519"></a><a name="p78452045152519"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul13543194815519"></a><a name="ul13543194815519"></a><ul id="ul13543194815519"><li>Oracle单行记录不能超过8K（text、blob部分计算），原因是MySQL innodb引擎限制单行大小不能超过8K。</li><li>不建议以字符串类型作为主键或唯一键，因为Oracle的字符串作为主键、唯一键时区分空格，而MySQL不区分，可能导致数据不一致和死锁问题。</li><li>binary_float或者binary_double类型不支持设置Nan、Inf、-Inf三个值，因为MySQL不支持。</li><li>Oracle的check约束迁移到MySQL会失效，原因是MySQL不支持check约束。</li><li>Oracle中建议列名不要取名AUTO_PK_ROW_ID，原因是这个列名在MySQL5.7中是保留列名，无法创建出来。</li><li>Oracle中number字段的值不要超过(65，30)的精度表示范围，int字段的值不要超过（65，0）的精度表示范围。原因是MySQL数字的表示范围比Oracle小。</li><li>库名、表名和视图名不支持的字符有：非ASCII字符、“. ”、 “&gt;”、 “&lt;”、 “\”、 “`”、 “|”、 “,”、 “? ”、 “! ”、 “"”和 “'”。</li><li>不支持字段的默认值为表达式，例如：default(`id` + 1)。</li><li>Oracle到MySQL的增量迁移，要求源数据库打开归档日志。</li><li>Oracle到MySQL增量迁移，要求源数据库的补充日志级别为primary key，unique级别。</li><li>源数据库不允许存在索引列的长度之和超过目标库索引列长度限制的索引，具体长度要求请参见<a href="https://support.huaweicloud.com/drs_faq/drs_04_0022.html" target="_blank" rel="noopener noreferrer">索引长度说明</a>。</li><li>默认值不支持default user，mysql没有对应的语法。</li><li>源数据库不允许含有空库。</li></ul>
    </td>
    </tr>
    <tr id="row158452456257"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p484554592519"><a name="p484554592519"></a><a name="p484554592519"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul15445484515"></a><a name="ul15445484515"></a><ul id="ul15445484515"><li>目标数据库不能存在待迁移数据库。</li><li>DRS同步时会有大量数据写入目标库，目标库max_allowed_packet 参数过小会导致无法写入，建议将目标库max_allowed_packet参数值设置为大于100MB。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


## Oracle数据库-\>RDS for PostgreSQL迁移场景<a name="section15616113065711"></a>

-   针对一些无法预知或人为因素及环境突变导致迁移失败的情况，数据复制服务提供以下常见的操作限制，供您在迁移过程中参考。

    **表 12**  操作要求

    <a name="table2703504253"></a>
    <table><thead align="left"><tr id="row1570145016251"><th class="cellrowborder" valign="top" width="18.32%" id="mcps1.2.3.1.1"><p id="p570650202514"><a name="p570650202514"></a><a name="p570650202514"></a><strong id="b1070450162511"><a name="b1070450162511"></a><a name="b1070450162511"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.67999999999999%" id="mcps1.2.3.1.2"><p id="p770175017253"><a name="p770175017253"></a><a name="p770175017253"></a><strong id="b8701050142519"><a name="b8701050142519"></a><a name="b8701050142519"></a>操作限制</strong>（需要人为配合）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row16701350142510"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p1570175014257"><a name="p1570175014257"></a><a name="p1570175014257"></a>注意事项</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul41740611012"></a><a name="ul41740611012"></a><ul id="ul41740611012"><li><a href="#table10694508252">表13</a>中的环境要求均不允许在迁移过程中修改，直至迁移结束。</li><li>相互关联的数据对象要确保同时迁移，避免迁移因关联对象缺失，导致迁移失败。常见的关联关系：视图引用表、视图引用视图、主外键关联表等。</li><li>目前仅支持全量迁移。</li><li>单个迁移任务每次只能迁移一个库（owner）的数据，多个数据库的迁移需要创建多个任务。</li><li>表、视图等对象名迁移到目标库后会转换成小写，如ABC和abc。</li><li>源库和目标库时区设置必须一致。</li><li>如有中文、日文等特殊字符，业务连接Oracle数据库使用的编码需和Oracle数据库服务端编码一致，否则目标库会出现乱码。</li><li>由于无主键表缺乏行的唯一性标志，在网络不稳定情况下，迁移后，可能存在目标与源库数据不一致的情况。</li></ul>
    </td>
    </tr>
    <tr id="row1092312131315"><td class="cellrowborder" valign="top" width="18.32%" headers="mcps1.2.3.1.1 "><p id="p843610118105"><a name="p843610118105"></a><a name="p843610118105"></a>操作须知</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.67999999999999%" headers="mcps1.2.3.1.2 "><a name="ul5950142213318"></a><a name="ul5950142213318"></a><ul id="ul5950142213318"><li>对于迁移中的数据库对象，在迁移期间，源库和目标库都不能进行写入操作，否则会导致数据不一致。</li><li>迁移过程中，不允许修改、删除连接源和目标数据库的用户的用户名、密码、权限，或修改源和目标数据库的端口号。</li><li>迁移过程中，源库不能做DDL变更。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

-   在线迁移对环境有一些特定的要求，请确保环境配置满足以下条件。该类型的要求系统会自动检查，并给出处理建议。

    **表 13**  环境要求

    <a name="table10694508252"></a>
    <table><thead align="left"><tr id="row20691850142513"><th class="cellrowborder" valign="top" width="18.310000000000002%" id="mcps1.2.3.1.1"><p id="p12691050192515"><a name="p12691050192515"></a><a name="p12691050192515"></a><strong id="b669135011258"><a name="b669135011258"></a><a name="b669135011258"></a>类型名称</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="81.69%" id="mcps1.2.3.1.2"><p id="p169155010255"><a name="p169155010255"></a><a name="p169155010255"></a><strong id="b146935072516"><a name="b146935072516"></a><a name="b146935072516"></a>使用限制</strong>（DRS自动检查）</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row1269165013258"><td class="cellrowborder" valign="top" width="18.310000000000002%" headers="mcps1.2.3.1.1 "><p id="p15690504257"><a name="p15690504257"></a><a name="p15690504257"></a>数据库权限设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.69%" headers="mcps1.2.3.1.2 "><a name="ul101851630991"></a><a name="ul101851630991"></a><ul id="ul101851630991"><li>源数据库端：需要具有DBA权限。</li><li>目标数据库端：用户权限需要具备在目标库创建数据库和表的权限。</li></ul>
    </td>
    </tr>
    <tr id="row5701050172513"><td class="cellrowborder" valign="top" width="18.310000000000002%" headers="mcps1.2.3.1.1 "><p id="p57095014251"><a name="p57095014251"></a><a name="p57095014251"></a>迁移对象约束</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.69%" headers="mcps1.2.3.1.2 "><a name="ul318683017916"></a><a name="ul318683017916"></a><ul id="ul318683017916"><li>支持表、视图、索引、约束、数据的迁移，其他数据库对象暂不支持，如存储过程等。</li><li>不支持函数索引迁移。<p id="p618603018916"><a name="p618603018916"></a><a name="p618603018916"></a>示例：</p>
    <pre class="codeblock" id="codeblock318616301490"><a name="codeblock318616301490"></a><a name="codeblock318616301490"></a>create index idx_t on t(substr(dt, 1, 8));</pre>
    </li></ul>
    </td>
    </tr>
    <tr id="row770175015256"><td class="cellrowborder" valign="top" width="18.310000000000002%" headers="mcps1.2.3.1.1 "><p id="p127055062513"><a name="p127055062513"></a><a name="p127055062513"></a>源数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.69%" headers="mcps1.2.3.1.2 "><a name="ul639234311919"></a><a name="ul639234311919"></a><ul id="ul639234311919"><li>由于PostgreSQL数据库比Oralce数据库多了一层schema结构，在视图创建语句中as子句中不能包含db.table的形式，否则视图迁移会失败。<p id="p16392184311913"><a name="p16392184311913"></a><a name="p16392184311913"></a>示例：将以下的语句一需要改写成语句二。</p>
    <p id="p43921436911"><a name="p43921436911"></a><a name="p43921436911"></a>语句一：</p>
    <pre class="codeblock" id="codeblock2039284317917"><a name="codeblock2039284317917"></a><a name="codeblock2039284317917"></a>create view v1 as select id from db1.t1;</pre>
    <p id="p193929438915"><a name="p193929438915"></a><a name="p193929438915"></a>语句二：</p>
    <pre class="codeblock" id="codeblock0392343999"><a name="codeblock0392343999"></a><a name="codeblock0392343999"></a>create view v1 as select id from t1;</pre>
    </li><li>timestamp和interval day to second类型支持的最大精度是6。</li><li>数据类型不支持bfile、xmltype、sdo_geometry和自定义类型。</li><li>源库不能存在只是大小写不同的表。</li><li>库名、表名和视图名不支持的字符有：非ASCII字符、“. ”、 “&gt;”、 “&lt;”、 “\”、 “`”、 “|”、 “,”、 “? ”、 “! ”、 “"”和 “'”。</li><li>目标库为PostgreSQL 11.x或者PostgreSQL增强版时，源库中同一个数据库下的触发器名称必须唯一。</li><li>源数据库不允许为空。</li></ul>
    </td>
    </tr>
    <tr id="row970550132516"><td class="cellrowborder" valign="top" width="18.310000000000002%" headers="mcps1.2.3.1.1 "><p id="p470350202512"><a name="p470350202512"></a><a name="p470350202512"></a>目标数据库要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="81.69%" headers="mcps1.2.3.1.2 "><a name="ul93937432918"></a><a name="ul93937432918"></a><ul id="ul93937432918"><li>目标库必须是本云RDS for PostgreSQL增强版实例。</li><li>迁移前，需要手动在目标数据库端创建一个与源数据库名对应的全部以小写字母命名的数据库，且待迁移的对象不存在于该创建的数据库中。</li><li>目标数据库中不能存在与源数据库转换成小写后相同的对象名。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


